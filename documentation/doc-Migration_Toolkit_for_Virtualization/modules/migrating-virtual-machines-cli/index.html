<!DOCTYPE html>
<html lang="en-US">
  <head>

    
    <meta charset="UTF-8">
    
    <title>Forklift Documentation</title>
    <!-- # Opengraph protocol properties: https://ogp.me/ -->
    <meta name="author" content="Forklift documentation team" >
    <meta property="og:type" content="article" >
    <meta name="twitter:card" content="summary">
    <meta name="keywords" content="" >
    <meta property="og:type" content="website">
    <meta property="og:image" content="">
    <meta property="og:article:author" content="Forklift documentation team" >
    <meta property="og:article:published_time" content="2022-01-16 18:26:23 -0600" >
    <meta name="twitter:title" content="Forklift Documentation">
    <meta name="twitter:description" content="Migrating VMware virtual machines to KubeVirt">

    <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Forklift Documentation | Migrating VMware virtual machines to KubeVirt</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Forklift Documentation" />
<meta name="author" content="Forklift documentation team" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Migrating VMware virtual machines to KubeVirt" />
<meta property="og:description" content="Migrating VMware virtual machines to KubeVirt" />
<meta property="og:site_name" content="Forklift Documentation" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Forklift Documentation" />
<meta name="twitter:site" content="@konveyor_io" />
<meta name="twitter:creator" content="@Forklift documentation team" />
<script type="application/ld+json">
{"url":"/documentation/doc-Migration_Toolkit_for_Virtualization/modules/migrating-virtual-machines-cli/","author":{"@type":"Person","name":"Forklift documentation team"},"@type":"WebPage","description":"Migrating VMware virtual machines to KubeVirt","headline":"Forklift Documentation","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/assets/img/forklift-logo-darkbg.svg"},"name":"Forklift documentation team"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="/assets/css/style.css?v=c35534d584bea736bfb5eb0abda50ee5b5f2dda9">
    <link rel="shortcut icon" type="image/png" href="images/favicon.png">
  </head>
  <body>
    <header class="page-header">
        
          <a href="/"><img src="/assets/img/forklift-logo-darkbg.svg" alt="Forklift Documentation" width="200" /></a><br>
        
      
        <a href="https://github.com/konveyor/forklift-documentation" class="btn">View on GitHub</a>
      
      
    </header>

    <main id="content" class="main-content" role="main">
      <h1 id="migrating-virtual-machines-cli_forklift">Migrating virtual machines</h1>
<div class="paragraph">
<p>You migrate virtual machines (VMs) from the command line (CLI) by creating Forklift custom resources (CRs).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>You must specify a name for cluster-scoped CRs.</p>
</div>
<div class="paragraph">
<p>You must specify both a name and a namespace for namespace-scoped CRs.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You must be logged in as a user with <code>cluster-admin</code> privileges.</p>
</li>
<li>
<p>VMware only: You must have a VMware Virtual Disk Development Kit (VDDK) image in a secure registry that is accessible to all clusters.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>VMware only: Add the VDDK image to the <code>HyperConverged</code> CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: hco.kubevirt.io/v1beta1
kind: HyperConverged
metadata:
  name: kubevirt-hyperconverged
  namespace: openshift-cnv
spec:
  vddkInitImage: &lt;registry_route_or_server_path&gt;/vddk:&lt;tag&gt; <b class="conum">(1)</b>
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Specify the VDDK image that you created.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create a <code>Secret</code> manifest for the source provider credentials:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: v1
kind: Secret
metadata:
  name: &lt;secret&gt;
  namespace: konveyor-forklift
type: Opaque
stringData:
  user: &lt;user&gt; <b class="conum">(1)</b>
  password: &lt;password&gt; <b class="conum">(2)</b>
  cacert: &lt;oVirt_ca_certificate&gt; <b class="conum">(3)</b>
  thumbprint: &lt;vcenter_fingerprint&gt; <b class="conum">(4)</b>
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Specify the base64-encoded vCenter admin user or the oVirt Engine user.</p>
</li>
<li>
<p>Specify the base64-encoded password.</p>
</li>
<li>
<p>oVirt only: Specify the base64-encoded CA certificate of the Engine. You can retrieve it at <code><a href="https://&lt;www.example.com&gt;/ovirt-engine/services/pki-resource?resource=ca-certificate&amp;format=X509-PEM-CA" class="bare">https://&lt;www.example.com&gt;/ovirt-engine/services/pki-resource?resource=ca-certificate&amp;format=X509-PEM-CA</a></code>.</p>
</li>
<li>
<p>VMware only: Specify the vCenter SHA-1 fingerprint.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create a <code>Provider</code> manifest for the source provider:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Provider
metadata:
  name: &lt;provider&gt;
  namespace: konveyor-forklift
spec:
  type: &lt;provider_type&gt; <b class="conum">(1)</b>
  url: &lt;api_end_point&gt; <b class="conum">(2)</b>
  secret:
    name: &lt;secret&gt; <b class="conum">(3)</b>
    namespace: konveyor-forklift
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Allowed values are <code>ovirt</code> and <code>vsphere</code>.</p>
</li>
<li>
<p>Specify the API end point URL, for example, <code><a href="https://&lt;www.example.com&gt;/sdk" class="bare">https://&lt;www.example.com&gt;/sdk</a></code> for vSphere or <code><a href="https://&lt;www.example.com&gt;/ovirt-engine/api/" class="bare">https://&lt;www.example.com&gt;/ovirt-engine/api/</a></code> for oVirt.</p>
</li>
<li>
<p>Specify the name of provider <code>Secret</code> CR.</p>
</li>
</ol>
</div>
</li>
<li>
<p>VMware only: Create a <code>Host</code> manifest:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Host
metadata:
  name: &lt;vmware_host&gt;
  namespace: konveyor-forklift
spec:
  provider:
    namespace: konveyor-forklift
    name: &lt;source_provider&gt; <b class="conum">(1)</b>
  id: &lt;source_host_mor&gt; <b class="conum">(2)</b>
  ipAddress: &lt;source_network_ip&gt; <b class="conum">(3)</b>
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Specify the name of the VMware <code>Provider</code> CR.</p>
</li>
<li>
<p>Specify the managed object reference (MOR) of the VMware host.</p>
</li>
<li>
<p>Specify the IP address of the VMware migration network.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create a <code>NetworkMap</code> manifest to map the source and destination networks:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$  cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: NetworkMap
metadata:
  name: &lt;network_map&gt;
  namespace: konveyor-forklift
spec:
  map:
    - destination:
        name: &lt;pod&gt;
        namespace: konveyor-forklift
        type: pod <b class="conum">(1)</b>
      source: <b class="conum">(2)</b>
        id: &lt;source_network_id&gt; <b class="conum">(3)</b>
        name: &lt;source_network_name&gt;
    - destination:
        name: &lt;network_attachment_definition&gt; <b class="conum">(4)</b>
        namespace: &lt;network_attachment_definition_namespace&gt; <b class="conum">(5)</b>
        type: multus
      source:
        id: &lt;source_network_id&gt;
        name: &lt;source_network_name&gt;
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: konveyor-forklift
    destination:
      name: &lt;destination_cluster&gt;
      namespace: konveyor-forklift
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Allowed values are <code>pod</code> and <code>multus</code>.</p>
</li>
<li>
<p>You can use either the <code>id</code> <em>or</em> the <code>name</code> parameter to specify the source network.</p>
</li>
<li>
<p>Specify the VMware network MOR or oVirt network UUID.</p>
</li>
<li>
<p>Specify a network attachment definition for each additional KubeVirt network.</p>
</li>
<li>
<p>Specify the namespace of the KubeVirt network attachment definition.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create a <code>StorageMap</code> manifest to map source and destination storage:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: StorageMap
metadata:
  name: &lt;storage_map&gt;
  namespace: konveyor-forklift
spec:
  map:
    - destination:
        storageClass: &lt;storage_class&gt;
        accessMode: &lt;access_mode&gt; <b class="conum">(1)</b>
      source:
        id: &lt;source_datastore&gt; <b class="conum">(2)</b>
    - destination:
        storageClass: &lt;storage_class&gt;
        accessMode: &lt;access_mode&gt;
      source:
        id: &lt;source_datastore&gt;
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: konveyor-forklift
    destination:
      name: &lt;destination_cluster&gt;
      namespace: konveyor-forklift
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Allowed values are <code>ReadWriteOnce</code> and <code>ReadWriteMany</code>.</p>
</li>
<li>
<p>Specify the VMware data storage MOR or oVirt storage domain UUID, for example, <code>f2737930-b567-451a-9ceb-2887f6207009</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Optional: Create a <code>Hook</code> manifest to run custom code on a VM during the phase specified in the <code>Plan</code> CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$  cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Hook
metadata:
  name: &lt;hook&gt;
  namespace: konveyor-forklift
spec:
  image: quay.io/konveyor/hook-runner <b class="conum">(1)</b>
  playbook: | <b class="conum">(2)</b>
    LS0tCi0gbmFtZTogTWFpbgogIGhvc3RzOiBsb2NhbGhvc3QKICB0YXNrczoKICAtIG5hbWU6IExv
    YWQgUGxhbgogICAgaW5jbHVkZV92YXJzOgogICAgICBmaWxlOiAiL3RtcC9ob29rL3BsYW4ueW1s
    IgogICAgICBuYW1lOiBwbGFuCiAgLSBuYW1lOiBMb2FkIFdvcmtsb2FkCiAgICBpbmNsdWRlX3Zh
    cnM6CiAgICAgIGZpbGU6ICIvdG1wL2hvb2svd29ya2xvYWQueW1sIgogICAgICBuYW1lOiB3b3Jr
    bG9hZAoK
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>You can use the default <code>hook-runner</code> image or specify a custom image. If you specify a custom image, you do not have to specify a playbook.</p>
</li>
<li>
<p>Optional: Base64-encoded Ansible playbook. If you specify a playbook, the <code>image</code> must be <code>hook-runner</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create a <code>Plan</code> manifest for the migration:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Plan
metadata:
  name: &lt;plan&gt; <b class="conum">(1)</b>
  namespace: konveyor-forklift
spec:
  warm: true <b class="conum">(2)</b>
  provider:
    source:
      name: &lt;source_provider&gt;
      namespace: konveyor-forklift
    destination:
      name: &lt;destination_cluster&gt;
      namespace: konveyor-forklift
  map:
    network: <b class="conum">(3)</b>
      name: &lt;network_map&gt; <b class="conum">(4)</b>
      namespace: konveyor-forklift
    storage:
      name: &lt;storage_map&gt; <b class="conum">(5)</b>
      namespace: konveyor-forklift
  targetNamespace: konveyor-forklift
  vms: <b class="conum">(6)</b>
    - id: &lt;source_vm&gt; <b class="conum">(7)</b>
    - name: &lt;source_vm&gt;
      hooks: <b class="conum">(8)</b>
        - hook:
            namespace: konveyor-forklift
            name: &lt;hook&gt; <b class="conum">(9)</b>
          step: &lt;step&gt; <b class="conum">(10)</b>
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Specify the name of the <code>Plan</code> CR.</p>
</li>
<li>
<p>VMware only: Specify whether the migration is warm or cold. If you specify a warm migration without specifying a value for the <code>cutover</code> parameter in the <code>Migration</code> manifest, only the precopy stage will run. Warm migration is not supported for oVirt.</p>
</li>
<li>
<p>You can add multiple network mappings.</p>
</li>
<li>
<p>Specify the name of the <code>NetworkMap</code> CR.</p>
</li>
<li>
<p>Specify the name of the <code>StorageMap</code> CR.</p>
</li>
<li>
<p>You can use either the <code>id</code> <em>or</em> the <code>name</code> parameter to specify the source VMs.</p>
</li>
<li>
<p>Specify the VMware VM MOR or oVirt VM UUID.</p>
</li>
<li>
<p>Optional: You can specify up to two hooks for a VM. Each hook must run during a separate migration step.</p>
</li>
<li>
<p>Specify the name of the <code>Hook</code> CR.</p>
</li>
<li>
<p>Allowed values are <code>PreHook</code>, before the migation plan starts, or <code>PostHook</code>, after the migration is complete.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Create a <code>Migration</code> manifest to run the <code>Plan</code> CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ cat &lt;&lt; EOF | kubectl apply -f -
apiVersion: forklift.konveyor.io/v1beta1
kind: Migration
metadata:
  name: &lt;migration&gt; <b class="conum">(1)</b>
  namespace: konveyor-forklift
spec:
  plan:
    name: &lt;plan&gt; <b class="conum">(2)</b>
    namespace: konveyor-forklift
  cutover: &lt;cutover_time&gt; <b class="conum">(3)</b>
EOF</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Specify the name of the <code>Migration</code> CR.</p>
</li>
<li>
<p>Specify the name of the <code>Plan</code> CR that you are running. The <code>Migration</code> CR creates a <code>VirtualMachineImport</code> CR for each VM that is migrated.</p>
</li>
<li>
<p>Optional: Specify a cutover time according to the ISO 8601 format with the UTC time offset, for example, <code>2021-04-04T01:23:45.678+09:00</code>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can associate multiple <code>Migration</code> CRs with a single <code>Plan</code> CR. If a migration does not complete, you can create a new <code>Migration</code> CR, without changing the <code>Plan</code> CR, to migrate the remaining VMs.</p>
</div>
</li>
<li>
<p>View the <code>VirtualMachineImport</code> pods to monitor the progress of the migration:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ kubectl get pods -n konveyor-forklift</code></pre>
</div>
</div>
</li>
</ol>
</div>

      <footer class="site-footer">
        
          <span class="site-footer-owner"><p align="center"><a href="https://github.com/konveyor/forklift-documentation">forklift-documentation</a> is maintained by <a href="https://github.com/konveyor">konveyor</a>.</p></span>
        
      </footer>
    </main>
  </body>
</html>
